#!/usr/bin/bash

# flags
help_flag=false
recursion_flag=false
lowercase_flag=false
uppercase_flag=false

# parameters handling with getopts
while getopts :rluh params
do
    case $params in  # set flags according to parameters
    h)  help_flag=true ;;
    r)  recursion_flag=true ;;
    l)  lowercase_flag=true ;;
    u)  uppercase_flag=true ;;
    ?)  echo Unknown argument. 1>&2
        help_flag=true ;;
    esac
done

shift $(($OPTIND - 1))  # shift positional arguments when all defined arguments are parsed

if $help_flag || ($uppercase_flag && $lowercase_flag) || ( [ $OPTIND -eq 1 ] && [ -z "$2" ]); then # display help and terminate execution
    echo -e "Usage: modify [OPTION]... [SED PATTERN] [[DIR]FILE]"
    echo -e "Modify name of the FILEs.\n"
    echo -e "Options:"
    echo -e " -r\t rename FILEs recursively"
    echo -e " -l\t change all uppercase letters into lowercase letters"
    echo -e " -u\t change all lowercase letters into uppercase letters"
    echo -e " -h\t display this help\n"
    echo -e "Alternatively, a SED PATTERN may be used instead of uppercase and lowercase options."
    exit

elif $recursion_flag; then # rename files in recursive way
    if $lowercase_flag; then
        find "$1" -type f -print0 | while read -d '' file_with_path
        do
            file_name=$(basename "$file_with_path")
            dir_name=$(dirname "$file_with_path")
            mv -- "$file_with_path" "$dir_name/${file_name,,}" # change all upercase letters in the name into uppercase
        done

    elif $uppercase_flag; then
        find "$1" -type f -print0 | while read -d '' file_with_path
        do
            file_name=$(basename "$file_with_path")
            dir_name=$(dirname "$file_with_path")
            mv -- "$file_with_path" "$dir_name/${file_name^^}" # change all upercase letters in the name into uppercase
        done
    else
        for file_with_path in $(find $2 -type f)
        do
            file_name=$(basename $file_with_path)
            dir_name=$(dirname $file_with_path)
            mv -- "$file_with_path" "$dir_name/$(echo "$file_name" | sed "$1")"   # change the name according to sed pattern
        done
    fi
else
    if $lowercase_flag; then
        file_name=$(basename $1)
        dir_name=$(dirname $1)
        mv "$1" "$dir_name/${file_name,,}"  # change all upercase letters in the name into lowercase

    elif $uppercase_flag; then
        file_name=$(basename $1)
        dir_name=$(dirname $1)
        mv "$1" "$dir_name/${file_name^^}" # change all upercase letters in the name into lowercas

    else                                      
        file_name=$(basename $2)
        dir_name=$(dirname $2)
        mv "$2" "$dir_name/$(echo "$file_name" | sed "$1")"   # change the name according to sed pattern
    fi
fi